

## 页面最终效果

![](http://images2015.cnblogs.com/blog/138012/201701/138012-20170121133301796-581383353.png)

## 路由

找到路由配置页面`./app/router/routeMap.jsx`可以看到配置城市页面的路由代码。

```jsx
<Route path='/' component={App}>
    ......
    <Route path='/city' component={City}/>
    ......
</Route>
```

路由引用的是`./app/containers/City`这个页面。**注意，它还有个`App`的父组件，跟之前讲的`Home`一样**。

## `City`页面

既然是选择城市页面，那么至少要支持两个功能

- 显示当前城市
- 允许修改城市

这两个功能，都需要 Redux 的支持，因此`City`页面要能连接 Redux ，React 组件连接 Redux 之前已经讲解过两次，这里不再详细解释

```jsx
function mapStateToProps(state) {
    return {
        userinfo: state.userinfo
    }
}

function mapDispatchToProps(dispatch) {
    return {
        userInfoActions: bindActionCreators(userInfoActionsFromOtherFile, dispatch)
    }
}
export default connect(
    mapStateToProps,
    mapDispatchToProps
)(City)
```

## 跳转到城市选择页

在`HomeHeader`组件中，加一个链接，点击时能跳转到城市选择页面。这里用到了`react-router`中的`<Link>`组件

```jsx
<Link to="/city">
    <span>{this.props.cityName}</span>
    &nbsp;
    <i className="icon-angle-down"></i>
</Link>
```

## `Header`组件

页面最上部是一个红色的 Header，显示页面标题，左侧有一个返回icon。不仅仅是这个页面，其他页面也会有这样的标题。多个页面公用的东西，就可以抽离成一个组件。

在`./app/components`中创建`Header`组件，然后引用到`City`页面中，并传入页面标题

```jsx
<Header title="选择城市"/>
```

`Header`组件的代码非常简单，显示标题，然后支持返回功能

```jsx
    render() {
        return (
            <div id="common-header">
                <span className="back-icon" onClick={this.clickHandle.bind(this)}>
                    <i className="icon-chevron-left"></i>
                </span>
                <h1>{this.props.title}</h1>
            </div>
        )
    }
    clickHandle() {
        window.history.back()
    }
```

最后一步是样式的美化。

## 显示当前城市

用 React、Vue 框架来开发 webapp 时，就得要求页面被拆分成非常细粒度的组件，这里虽然只是显示当前城市，也要作为一个组件抽离出去。

创建一个`CurrentCity`组件，并引用到`City`页面，然后将当前城市传递给它来显示

```jsx
<CurrentCity cityName={this.props.userinfo.cityName}/>
```

`CurrentCity`组件的代码也非常简单，只需要显示出当前城市即可。剩下的就是一些样式的美化。

```jsx
    render() {
        return (
            <div className="current-city">
                <h2>{this.props.cityName}</h2>
            </div>
        )
    }
```
