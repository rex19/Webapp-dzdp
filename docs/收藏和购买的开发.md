
# 收藏和购买的开发


## 最终页面效果

![](http://images2015.cnblogs.com/blog/138012/201701/138012-20170124221152503-437566496.png)

## 增加“收藏 & 购买”子页面

定位到`Detail`页面，本节教程讲解的功能需要在该页面的基础上再做增加。先增加一个`subpage/Buy.jsx`的子页面，然后引入到`Detail`页面中，并传入`id`

```jsx
<Buy id={id}/>
```

该子页面中需要用到用户信息（将用于登录验证功能），因此要连接 Redux

```jsx
function mapStateToProps(state) {
    return {
        userinfo: state.userinfo
    }
}

function mapDispatchToProps(dispatch) {
    return {
    }
}
export default connect(
    mapStateToProps,
    mapDispatchToProps
)(Buy)
```

## 创建组件

在`Buy.jsx`子页面中，需要两个按钮——“收藏”和“购买”，这两个按钮我们要放在一个组件中做。创建`./app/components/BuyAndStore`组件，然后引入到子页面中。不过需要注意两点

- 需要告诉组件，这个商户是否已经被收藏了。如果已经被收藏需要显示“已收藏”文字，如果未被收藏需要显示“收藏”按钮
- “收藏”和“购买”两个按钮点击之后的事件，需要在子页面中定义

```jsx
<BuyAndStore isStore={this.state.isStore} buyHandle={this.buyHandle.bind(this)} storeHandle={this.storeHandle.bind(this)}/>
```

## 登录验证

收藏和购买功能，都需要用户登录之后才能执行，因此这里先定义一个登录验证的功能，后面会用到。下面代码中跳转到`/Login`页面时，带了一个`router`参数。

```jsx
    // 检查登录状态
    loginCheck() {
        const id = this.props.id
        const userinfo = this.props.userinfo
        if (!userinfo.username) {
            // 跳转到登录页面的时候，要传入目标router，以便登录完了可以自己跳转回来
            hashHistory.push('/Login/' + encodeURIComponent('/detail/' + id))
            return false
        }
        return true
    }
```

## 购买功能

购买功能，首先要验证登录，然后**模拟购买**。

```jsx
    // 购买事件
    buyHandle() {
        // 验证登录，未登录则retur
        const loginFlag = this.loginCheck()
        if (!loginFlag) {
            return
        }

        // 此过程为模拟购买，因此可省去复杂的购买过程

        // 跳转到用户主页
        hashHistory.push('/User')
    }
```